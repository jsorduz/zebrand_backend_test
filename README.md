# Zebrand Backend test
This repository solves the [technical test](https://github.com/luuna-tech/test/tree/master/backend) for backend developer in zebrands. 

The design is in the following file:

https://drive.google.com/file/d/1nrdTli4dmZUdG2-RE6SDB_Y_Vl9eR_5X/view?usp=share_link

It has 5 stages:
- Use cases
- Actors definition
- Database design
- Technologies selection
- Final Architecture

## DB
The database define 3 models:
- User: it stores admin data
- Brand: It stores brand data
- Product: it stores product data
### Future enhancement
- NotificationMechanism: it stores the preferred notification mechanisms for admins
- AnonymousProductView: it stores anonymous user metadata for further analysis about products querying

## Technologies
It was selected:
- DB: sqlite because it is easy to use and perfect for TDD
- Web framework: FastAPI because it is suitable for small projects, generates automatic documentation and provide background processes for small jobs.
- Background processes: FastAPI includes background processes
### Future enhancement
- Events backbone: replace the FastAPI background processes by a more robust tool as celery and use an events backbone as Event Hub, SQS or Redis Stream.

## Architecture
- FastAPI instance for backend
- In memory SQLite instance for DB
### Future enhancement
- Replace SQLite by a db suitable to recollect anonymous user metadata, for example, TimescaleDB
- Add an events backbone as Redis Streams
- Implement consumers to handle notifications events

## Local deployment
To deploy a local instance of the repository using uvicorn on http://127.0.0.1:8000/ use the following commands
```python
pip install -r requirements_dev.txt
uvicorn app.main:app
```
Use the following url to get the autogenerated documentation:
> http://127.0.0.1:8000/docs

**Note**: The instance uses an in-memory SQLite db, then after uvicorn server is stopped all data will be deleted.

### Formatters
The file *pyproject.toml* includes configurations to run **black** and **isort** formatters with the following commands (Both libraries were installed in requirements_dev.txt):
```sh
black app tests
isort app tests
```
The sript *local-ci.sh* runs the above commands together.

### tests
The tests are implemented with **pytest**, to run the tests with coverage use the following command:
```sh
pytest --cov
```
The sript *local-ci.sh* runs the tests as well.

## Docker deployment
To deploy with docker this repository use the following commands:
```sh

docker build -t zebrand_backend_test .
docker run -p 8000:80 --name zebrand-backend-container zebrand_backend_test
```
This will deploy a local instance on http://127.0.0.1:8000/. Like the local deployment, when the docker instance is stopped the data is deleted.
